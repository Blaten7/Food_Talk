// 공통 기능 함수 로직 [1]
{
    document.addEventListener("DOMContentLoaded", (function () {
        // 차트 초기화 코드
        var e = document.querySelectorAll("[data-bss-chart]")
        for (var t of e) {
            t.chart = new Chart(t, JSON.parse(t.dataset.bssChart));
        }
    }), !1);
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.cgSelector').forEach(function (el) {
            el.addEventListener('click', function () {
                cgSort(el);
            });
        });
    });

    (function () {
        "use strict";
        // 사이드바와 토글 버튼 선택
        var e = document.querySelector(".sidebar"),
            t = document.querySelectorAll("#sidebarToggle, #sidebarToggleTop");
        if (e) {
            // 사이드바의 collapse 초기화
            var o = [].slice.call(document.querySelectorAll(".sidebar .collapse")).map((function (e) {
                return new bootstrap.Collapse(e, {toggle: !1});
            }));
            // 사이드바 토글 버튼 클릭 이벤트 리스너
            for (var n of t) n.addEventListener("click", (function (t) {
                document.body.classList.toggle("sidebar-toggled");
                e.classList.toggle("toggled");
                if (e.classList.contains("toggled")) {
                    for (var n of o) n.hide();
                }
            }));
            // 윈도우 리사이즈 이벤트 리스너
            window.addEventListener("resize", (function () {
                if (Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0) < 768) {
                    for (var e of o) e.hide();
                }
            }));
        }
        // 사이드바 스크롤 이벤트
        var r = document.querySelector("body.fixed-nav .sidebar");
        if (r) {
            r.addEventListener("mousewheel", handleScroll);
            r.addEventListener("DOMMouseScroll", handleScroll);
            r.addEventListener("wheel", handleScroll);

            function handleScroll(e) {
                if (Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0) > 768) {
                    var t = e.wheelDelta || -e.detail;
                    r.scrollTop += 30 * (t < 0 ? 1 : -1);
                    e.preventDefault();
                }
            }
        }
        // console.log("에러 발생문 시작")
        // 스크롤-투-탑 버튼 이벤트
        var l = document.querySelector(".scroll-to-top");
        if (l) {
            window.addEventListener("scroll", (function () {
                var e = window.pageYOffset;
                l.style.display = e > 100 ? "block" : "none";
            }));
        }
        // 헤더 알림갯수 파악후 숫자로 보여주는 기능
        let notice = document.querySelector("#span-notice-count");
        let noticelist = document.querySelectorAll("#noticelist a");
        notice.innerHTML = noticelist.length - 2 + "+";

        // 헤더 메세지 개수 파악후 숫자로 보여주는 기능
        let span_message = document.querySelector("#span-message-count");
        let messagelist = document.querySelectorAll("#messagelist a");
        span_message.innerHTML = messagelist.length - 2 + "+";

    })();
}

// 대분류 [2]
{
// 대분류 안에 값 찍어내는 공장
    function BigCg(selectedValue) {
        let urlSort;
        $('#mDiv').html('')
        $('#sDiv').html('')
        document.querySelector('#selectedCg').value = selectedValue
        // $('#selectedCg').html(selectedValue)
        if (selectedValue == 'fooditem') {
            urlSort = "/bigcategory?cg=fooditem"
        } else if (selectedValue == 'recipe') {
            urlSort = "/bigcategory?cg=recipe"
        }
        $.ajax({
            method: 'get',
            url: urlSort
        }).done((resp) => {
            let bigCgDiv = $('#bDiv')
            let printInDiv = "";
            let i = 1; // div의 인덱스
            let j = 0; // 버튼의 인덱스

            for (const elem of resp) {
                if (j % 8 === 0) {
                    if (j !== 0) {
                        printInDiv += "</div>"; // 이전 div를 닫음
                    }
                    printInDiv += "<div id='bDiv" + i + "'>"; // 새로운 div를 생성
                    i++;
                }
                printInDiv += "<a class='cgTag' href='javascript:void(0)' onclick='midCg(" + elem.c_num + ")'>" + elem.c_name + "</a>";
                printInDiv += "<button class='deleteBtn' onclick='deleteThis(\"" + elem.c_name + "\",  this , " + elem.c_num + ")'>X</button><br><br>";
                j++;
            }

            if (printInDiv !== "") {
                printInDiv += "</div>"; // 마지막 div를 닫음
                bigCgDiv.html(printInDiv);
            } else {
                bigCgDiv.html("선택하신 항목의 대분류 값이 존재하지 않습니다");
                $('#mDiv').html("중분류 값이 존재하지 않습니다")
                $('#sDiv').html("소분류 값이 존재하지 않습니다")
            }
        }).fail((err) => {
            console.log("대분류 공장 폭파사건 발생!")
        })
    }
}

{
// 중분류 안에 값 찍어내는 공장
    function midCg(num) {
        document.querySelector('#selectedBigCgNum').value = num
        $.ajax({
            method: 'get',
            url: "/midcategory?cg=" + num
        }).done((resp) => {
            let midCgDiv = $('#mDiv')
            let printInDiv = "";
            let i = 1; // div의 인덱스
            let j = 0; // 버튼의 인덱스

            for (const elem of resp) {
                if (j % 5 === 0) {
                    if (j !== 0) {
                        printInDiv += "</div>"; // 이전 div를 닫음
                    }
                    printInDiv += "<div id='mDiv" + i + "'>"; // 새로운 div를 생성
                    i++;
                }
                printInDiv += "<a class='cgTag' href='javascript:void(0)' onclick='smCg(" + elem.c_num + ")'>" + elem.c_name + "</a>";
                printInDiv += "<button class='deleteBtn' onclick='deleteThis(\"" + elem.c_name + "\",  this , " + elem.c_num + ")'>X</button><br><br>";
                j++;
            }

            if (printInDiv !== "") {
                printInDiv += "</div>"; // 마지막 div를 닫음
                midCgDiv.html(printInDiv);
            } else {
                midCgDiv.html("선택하신 항목의 대분류 값이 존재하지 않습니다");
                $('#sDiv').html("")
                $('#sDiv').html("소분류 값이 존재하지 않습니다")
            }

        }).fail((err) => {
            console.log("중분류 공장 폭파사건 발생!")
        })
    }

{
// 소분류 안에 값 찍어내는 공장
    function smCg(num) {
        document.querySelector('#selectedMidCgNum').value = num
        $.ajax({
            method: 'get',
            url: "/smallcategory?cg=" + num
        }).done((resp) => {
            let smallCgDiv = $('#sDiv')
            let printInDiv = "";
            let i = 1; // div의 인덱스
            let j = 0; // 버튼의 인덱스

            for (const elem of resp) {
                if (j % 5 === 0) {
                    if (j !== 0) {
                        printInDiv += "</div>"; // 이전 div를 닫음
                    }
                    printInDiv += "<div id='mDiv" + i + "'>"; // 새로운 div를 생성
                    i++;
                }
                printInDiv += "<a class='cgTag' href='javascript:void(0)'>" + elem.c_name + "</a>";
                printInDiv += "<button class='deleteBtn' onclick='deleteThis(\"" + elem.c_name + "\",  this , " + elem.c_num + ")'>X</button><br><br>";
                j++;
            }

            if (printInDiv !== "") {
                printInDiv += "</div>"; // 마지막 div를 닫음
                smallCgDiv.html(printInDiv);
            } else {
                $('#sDiv').html("")
                $('#sDiv').html("소분류 값이 존재하지 않습니다")
            }
        }).fail((err) => {
            console.log("소분류 공장 폭파사건 발생!")
        })

    }


// 홈페이지 관리 항목별 정렬 [6]
 function boardListSortButton(id) {
     let ID = document.getElementById(id);
     console.log("====================================")
     console.log("조건 통과 전"+ID.className);
     if (ID.className === "Asort selected") {
         ID.classList.remove("selected");
     } else if (ID.className === "Asort") {
         ID.classList.add("selected");
     }
     console.log("조건 통과 후:"+ID.className);
     $.ajax({
         method: 'get',
         url: "/boardlistsort?id="+id
     }).done((resp) => {
         console.log("항목정렬DONE : "+ID.className);

             let boardList = $('#getBoardList');
             let boardListHeader = $('#boardListHeader');
             let sortWhat = "";
             let str = "";
             console.log("선택자 : "+isSelected)
             if (isSelected==='false') {
                 console.log("반복문 실행됨")
             str += "<table style='width: 100%'><tr style='background-color: #e1e1e1'><th>#</th>"
             str += "<th>상품코드<a onclick='boardListSortButton(this.id)' id='fcode' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></th>"
             str += "<th>대분류<a onclick='boardListSortButton(this.id)' id='fcnum' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></th>"
             str += "<th>중분류<a onclick='boardListSortButton(this.id)' id='fcnum2' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></th>"
             str += "<th>상품이름<a onclick='boardListSortButton(this.id)' id='ftitle' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></th>"
             str += "<th>가격<a onclick='boardListSortButton(this.id)' id='fprice' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></th>"
             str += "<th>수량<a onclick='boardListSortButton(this.id)' id='fcount' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></th>"
             str += "<th>등록일<a onclick='boardListSortButton(this.id)' id='fdate' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></th>"
             str += "<th>유통기한<a onclick='boardListSortButton(this.id)' id='fedate' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></th></tr>"
             str += "</table>"
                 boardListHeader.html(str);
             }
             isSelected = true;
             str = "";
             let i = 1;
             console.log(id)
            console.log(document.getElementById(id));
             console.log(ID.className);
             if (ID.className === 'Asort selected') {
                 sortWhat = resp
             } else if (document.getElementById(id).className === 'Asort') {
                 sortWhat = resp.reverse();
             } else {
                 console.log("항목정렬에서 무언가 잘못되었습니다")
                 return
             }
                str += "<table style='width: 100%'>"
             for (const elem of sortWhat) {
                 str += "<tr>"
                 str += "<td>"+i+"</td>"
                 str += "<td>"+elem.f_code+"</td>"
                 str += "<td>"+elem.c_num+"</td>"
                 str += "<td>"+elem.c_num2+"</td>"
                 str += "<td>"+elem.f_title+"</td>"
             str += "<td>"+elem.f_price+"</td>"
             str += "<td>"+elem.f_count+"</td>"
             str += "<td>"+elem.f_date+"</td>"
             str += "<td>"+elem.f_edate+"</td>"
             str += "</tr>"
             i++
         }
         str += "</table><br><br>"
         boardList.html(str)

     }).fail((err) => {
         console.log("정렬 실패")
     })
 }
// 카테고리 관리 스트링빌더 같은 느낌
function cgSort(cgName) {
    document.querySelectorAll('.cgSelector').forEach(function(el) {
        el.classList.remove('active');
    });
    cgName.classList.add('active');

    let urlSort;
    let title = document.querySelector('#boardTitle');
    let table = document.querySelector('#data');
    let modalTitle = document.querySelector('#outerModalTitle');
    // let currentPage = document.querySelector('#modal-input-submit').name
    let createInput = $('#modalDetails');
    let createInput2 = $('#modalDetails2');
    let createInput3 = $('#modalDetails3');
    let createInput4 = $('#modalDetails4');
    let stringBuilder = "";
    let stringBuilder2 = "";
    let stringBuilder3 = "";
    let stringBuilder4 = "";
    table.style.display = 'none';

    if (cgName.innerHTML === '레시피') {
        title.innerHTML = '레시피 게시글 리스트';
        modalTitle.innerHTML = '레시피 등록';
        document.querySelector('#modal-input-submit').name = '레시피'
        stringBuilder += "<input type='text' placeholder='레시피입력란' class='modal-input'>";
        urlSort = "/boardlist?tab=recipe";
    } else if (cgName.innerHTML === '식자재') {
        title.innerHTML = '식자재 리스트';
        modalTitle.innerHTML = '식자재 등록';
        formSort.innerHTML = '식자재'
        document.querySelector('#modal-input-submit').name = '식자재'
        stringBuilder4 += "<input type='text' value='상품코드' class='modal-input-name' style='height: 50px; width: 70px' disabled><br>"
        stringBuilder4 += "<input type='text' value='대  분  류' class='modal-input-name' style='height: 50px; width: 70px' disabled><br>"
        stringBuilder4 += "<input type='text' value='용        량' class='modal-input-name' style='height: 50px; width: 70px' disabled><br>"
        stringBuilder4 += "<input type='text' value='상품가격' class='modal-input-name' style='height: 50px; width: 70px' disabled><br>"
        stringBuilder4 += "<input type='text' value='원  산  지' class='modal-input-name' style='height: 50px; width: 70px' disabled><br>"
        stringBuilder3 += "<input type='text' name='foodItemCode-modalInput' class='modal-input' style='height: 50px; width: 150px'><br>"
        stringBuilder3 += "<input type='text' name='foodItemBigCg-modalInput' class='modal-input' style='height: 50px; width: 150px'><br>"
        stringBuilder3 += "<input type='text' name='foodItemVolume-modalInput' class='modal-input' style='height: 50px; width: 150px'><br>"
        stringBuilder3 += "<input type='text' name='foodItemPrice-modalInput' class='modal-input' style='height: 50px; width: 150px'><br>"
        stringBuilder3 += "<input type='text' name='foodItemOrigin-modalInput' class='modal-input' style='height: 50px; width: 150px'><br>"

        stringBuilder2 += "<input type='text' value='보관방법' class='modal-input-name' style='height: 50px; width: 70px' disabled><br>"
        stringBuilder2 += "<input type='text' value='중  분  류' class='modal-input-name' style='height: 50px; width: 70px' disabled><br>"
        stringBuilder2 += "<input type='text' value='칼  로  리' class='modal-input-name' style='height: 50px; width: 70px' disabled><br>"
        stringBuilder2 += "<input type='text' value='수        량' class='modal-input-name' style='height: 50px; width: 70px' disabled><br>"
        stringBuilder2 += "<input type='text' value='유통기한' class='modal-input-name' style='height: 50px; width: 70px' disabled><br>"
        stringBuilder += "<input type='text' name='foodItemSave-modalInput' placeholder='' class='modal-input' style='height: 50px; width: 150px'><br>"
        stringBuilder += "<input type='text' name='foodItemMidCg-modalInput' placeholder='' class='modal-input' style='height: 50px; width: 150px'><br>"
        stringBuilder += "<input type='text' name='foodItemCal-modalInput' placeholder='' class='modal-input' style='height: 50px; width: 150px'><br>"
        stringBuilder += "<input type='text' name='foodItemCounts-modalInput' placeholder='' class='modal-input' style='height: 50px; width: 150px'><br>"
        stringBuilder += "<input type='text' name='foodItemExDate-modalInput' placeholder='' class='modal-input' style='height: 50px; width: 150px'><br>"

        urlSort = "/boardlist?tab=fooditem";
    } else if (cgName.innerHTML === '카테고리') {
        window.location.href = "/homepageC";
    }

    createInput.html(stringBuilder);
    createInput2.html(stringBuilder2);
    createInput3.html(stringBuilder3);
    createInput4.html(stringBuilder4);
    $.ajax({
        method: 'get',
        url: urlSort
    }).done((resp) => {
        let boardList = $('#tableIsHere');
        if (cgName.innerHTML==='식자재') {
            let reverseResp = resp.reverse();
            boardList.html('')
            let str = "";
            str += "<div class='table-responsive table mt-2' id='dataTable' role='grid' aria-describedby='dataTable_info'>"
            str += "<table class='table my-0' id='dataList'>"
            str += "<tr class='table-primary' style='vertical-align: center'><th>#</th>"
            str += "<th><h4>상품코드<a onclick='boardListSortButton(this.id)' id='fcode' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></h4></th>"
            str += "<th><h4>대분류<a onclick='boardListSortButton(this.id)' id='fcnum' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></h4></th>"
            str += "<th><h4>중분류<a onclick='boardListSortButton(this.id)' id='fcnum2' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></h4></th>"
            str += "<th><h4>상품이름<a onclick='boardListSortButton(this.id)' id='ftitle' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></h4></th>"
            str += "<th><h4>가격<a onclick='boardListSortButton(this.id)' id='fprice' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></h4></th>"
            str += "<th><h4>수량<a onclick='boardListSortButton(this.id)' id='fcount' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></h4></th>"
            str += "<th><h4>등록일<a onclick='boardListSortButton(this.id)' id='fdate' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></h4></th>"
            str += "<th><h4>유통기한<a onclick='boardListSortButton(this.id)' id='fedate' class='Asort'><img src='/assets/img/a/sort.png' style='width: 20px; height: 20px'></a></h4></th>"
            str += "<td><input id='allClickCk' onclick='allClickCk(this)' value='selectAll' type='checkbox'>전체선택&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type='button' onclick='ckBoxDeleteBtn()' class='btn btn-danger'>삭제</button></td>"
            str += "</tr>"
            let i = 1;
            for (const elem of reverseResp) {
                str += "<tr data-fnum='"+elem.f_num+"'>"
                str += "<td>"+i+"</td>"
                str += "<td>"+elem.f_code+"</td>"
                str += "<td>"+elem.c_num+"</td>"
                str += "<td>"+elem.c_num2+"</td>"
                str += "<td>"+elem.f_title+"</td>"
                str += "<td>"+elem.f_price+"</td>"
                str += "<td>"+elem.f_count+"</td>"
                str += "<td>"+elem.f_date+"</td>"
                str += "<td>"+elem.f_edate+"</td>"
                str += "<th><input class='ckBox' name='selectCk' type='checkbox'></th>"
                str += "</tr>"
                i++
            }
            str += "</table><br><br>"
            boardList.html(str)
        } else if (cgName.innerHTML==='레시피') {
            boardList.html('')
            boardList.html("레시피 테이블 미구현")
        } else {
            boardList.html('')
            boardList.html("카테고리좀 똑바로 선택해주세요 짜증날라하니까 ㅇㅋ?")
        }
    }).fail((err) => {
    });
}

function closeOuterModal() {
    let xButton = document.getElementById("closeOuterModalButton");
    xButton.click();
}

// 자바스크립트 폼데이터 객체 관련
{
    function modalInputForm() {
        console.log("모달 인풋 폼 함수 진입");
        console.dir(document.querySelector('#previewImg'))
        let fiCode = document.querySelector('input[name="foodItemCode-modalInput"]').value;
        let fiBigCg = document.querySelector('input[name="foodItemBigCg-modalInput"]').value;
        let fiPrice = document.querySelector('input[name="foodItemPrice-modalInput"]').value;
        let fiMidCg = document.querySelector('input[name="foodItemMidCg-modalInput"]').value;
        let fiCounts = document.querySelector('input[name="foodItemCounts-modalInput"]').value;
        let fiExDate = document.querySelector('input[name="foodItemExDate-modalInput"]').value;
        let fiContents = document.querySelector('input[name="foodItemContents-modalInput"]').value;
        let fiTitle = document.querySelector('input[name="foodItemTitle-modalInput"]').value;
        let fiVolume = document.querySelector('input[name="foodItemVolume-modalInput"]').value;
        let fiOrigin = document.querySelector('input[name="foodItemOrigin-modalInput"]').value;
        let fiCal = document.querySelector('input[name="foodItemCal-modalInput"]').value;
        let fiSave = document.querySelector('input[name="foodItemSave-modalInput"]').value;
        let fiFile = document.querySelector('#preview').name
        console.log(fiFile)
        let formSort = $('#formSort').innerHTML
        let formData = new FormData();
        console.log(document.querySelector('#modal-input-submit').name)
        if (document.querySelector('#modal-input-submit').name === '레시피') {
            // 레시피 관련 처리
        } else if (document.querySelector('#modal-input-submit').name === '식자재') {
            // formData.append('file1', '파일'); // 이미지 첨부 관련 수정사항이 있어 잠시 주석처리 하였음
            formData.append('fiCode', fiCode);
            formData.append('fiBigCg', fiBigCg);
            formData.append('fiPrice', fiPrice);
            formData.append('fiMidCg', fiMidCg);
            formData.append('fiCounts', fiCounts);
            formData.append('fiExDate', fiExDate);
            formData.append('fiTitle', fiTitle);
            formData.append('fiContents', fiContents);
            formData.append('fiFile', fiFile);
            formData.append('fiVolume', fiVolume);
            formData.append('fiOrigin', fiOrigin);
            formData.append('fiCal', fiCal);
            formData.append('fiSave', fiSave);
        } else {
            alert("폼데이터 분류값이 잘못 되었습니다");
            return false;
        }
        console.log(formData)
        $.ajax({
            type: 'POST',
            url: "/fooditemmodalinput",
            data: formData,
            contentType: false,
            processData: false
        }).done((resp) => {
            console.log("폼데이터 비동기 DONE");
            closeOuterModal()
            let reverseResp = resp.reverse();
            let boardList = $('#getBoardList');
            let str = "";
            str += "<table style='width: 100%'><tr><th>#</th>"
            str += "<th>상품코드</th>"
            str += "<th>대분류</th>"
            str += "<th>중분류</th>"
            str += "<th>상품이름</th>"
            str += "<th>가격</th>"
            str += "<th>수량</th>"
            str += "<th>등록일</th>"
            str += "<th>유통기한</th></tr>"
            let i = 1;
            for (const elem of reverseResp) {
                str += "<tr>"
                str += "<td>"+i+"</td>"
                str += "<td>"+elem.f_code+"</td>"
                str += "<td>"+elem.c_num+"</td>"
                str += "<td>"+elem.c_num2+"</td>"
                str += "<td>"+elem.f_title+"</td>"
                str += "<td>"+elem.f_price+"</td>"
                str += "<td>"+elem.f_count+"</td>"
                str += "<td>"+elem.f_date+"</td>"
                str += "<td>"+elem.f_edate+"</td>"
                str += "</tr>"
                i++
            }
            str += "</table><br><br>"
            boardList.html(str)
        }).fail((err) => {
            console.log("폼데이터 비동기 FAIL");
            console.log(err);
        });
    }
}

// 파일 첨부 관련
        {
            function validFileType(filename) {
                const fileTypes = ["png", "jpg", "jpeg"];
                return fileTypes.indexOf(filename.substring(filename.lastIndexOf(".") + 1, filename.length).toLowerCase()) >= 0;
            }

            function validFileSize(file) {
                if (file.size > 10000000) { //10MB
                    return false;
                } else {
                    return true;
                }
            }

            function validFileNameSize(filename) {
                if (filename.length > 30) { //30자
                    return false;
                } else {
                    return true;
                }
            }

//이미지 띄우기
            function selectFile(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        document.getElementById('preview').src = e.target.result;
                    };
                    reader.readAsDataURL(input.files[0]);
                } else {
                    document.getElementById('preview').src = "";
                }}}}}




